<?php

/**
 * @file
 * Unit tests for the Twigshim module.
 */

/**
 * Tests for the Twigshim module.
 */
class TwigshimTestCase extends DrupalUnitTestCase {

  /**
   * Provides information about the test suite.
   */
  public static function getInfo() {
    return array(
      'name' => 'Twigshim',
      'description' => 'Performs tests for the Twigshim module.',
      'group' => 'Theme',
    );
  }

  /**
   * Make sure the environment has Twigshim installed.
   */
  public function setUp() {
    drupal_load('module', 'twigshim');
    parent::setUp();
  }

  /**
   * Run a test on the render function with the given parameters.
   */
  private function runTwigshimRenderTest($template, $options, $expected, $message) {
    $path = drupal_get_path('module', 'twigshim') . '/' . $template;
    $result = twigshim_render($path, $options);
    $this->assertEqual($expected, trim($result), $message);
  }

  /**
   * Tests the twigshim_render() function.
   */
  public function testRender() {
    $opts = array(
      'name' => 'Twigshim Testing',
      'type' => 'awesomeness',
    );
    $expected = 'The <em>Twigshim Testing awesomeness</em> provides a simple way to render Twig templates in Drupal.';
    $message = "Twigshim's twigshim_render() function renders Twig correctly.";
    $this->runTwigshimRenderTest('twigshim.example.html.twig', $opts, $expected, $message);
  }

  /**
   * Tests the twigshim_render() function.
   */
  public function testFilters() {
    $expected = 'The Translation Filter is great!';
    $message = "The t() filter runs correctly.";
    $this->runTwigshimRenderTest('tests/filtertest.twig', array(), $expected, $message);
  }

}
